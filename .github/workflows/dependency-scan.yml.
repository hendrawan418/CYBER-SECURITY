
name: Python Dependency Vulnerability Scan

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  scan:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    - name: Install Safety
      run: |
        pip install safety
    
    - name: Run Safety Scan
      run: |
        safety check -r requirements.txt --full-report
      continue-on-error: false  # Gagal jika ada kerentanan
    
    - name: Upload SARIF file
      uses: github/codeql-action/upload-sarif@v3
      with:
        sarif_file: safety-output.sarif
      if: always()
